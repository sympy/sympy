

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.printing.latex &mdash; SymPy 0.7.3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://live.sympy.org/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.7.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/utilities.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/external/classy.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-core.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://live.sympy.org/static/live-sphinx.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="shortcut icon" href="../../../_static/SymPy-Favicon.ico"/>
    <link rel="top" title="SymPy 0.7.3 documentation" href="../../../index.html" />
    <link rel="up" title="sympy" href="../../sympy.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" accesskey="U">sympy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sympy.printing.latex</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A Printer which converts an expression into its LaTeX equivalent.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">S</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Add</span><span class="p">,</span> <span class="n">Symbol</span>
<span class="kn">from</span> <span class="nn">sympy.core.function</span> <span class="kn">import</span> <span class="n">_coeff_isneg</span>
<span class="kn">from</span> <span class="nn">sympy.core.sympify</span> <span class="kn">import</span> <span class="n">SympifyError</span>
<span class="kn">from</span> <span class="nn">sympy.core.alphabets</span> <span class="kn">import</span> <span class="n">greeks</span>

<span class="c">## sympy.printing imports</span>
<span class="kn">from</span> <span class="nn">.printer</span> <span class="kn">import</span> <span class="n">Printer</span>
<span class="kn">from</span> <span class="nn">.conventions</span> <span class="kn">import</span> <span class="n">split_super_sub</span><span class="p">,</span> <span class="n">requires_partial</span>
<span class="kn">from</span> <span class="nn">.precedence</span> <span class="kn">import</span> <span class="n">precedence</span><span class="p">,</span> <span class="n">PRECEDENCE</span>

<span class="kn">import</span> <span class="nn">sympy.mpmath.libmp</span> <span class="kn">as</span> <span class="nn">mlib</span>
<span class="kn">from</span> <span class="nn">sympy.mpmath.libmp</span> <span class="kn">import</span> <span class="n">prec_to_dps</span>

<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="kn">import</span> <span class="n">default_sort_key</span><span class="p">,</span> <span class="nb">xrange</span>
<span class="kn">from</span> <span class="nn">sympy.utilities.iterables</span> <span class="kn">import</span> <span class="n">has_variety</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="c"># Hand-picked functions which can be used directly in both LaTeX and MathJax</span>
<span class="c"># Complete list at http://www.mathjax.org/docs/1.1/tex.html#supported-latex-commands</span>
<span class="c"># This variable only contains those functions which sympy uses.</span>
<span class="n">accepted_latex_functions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;arcsin&#39;</span><span class="p">,</span> <span class="s">&#39;arccos&#39;</span><span class="p">,</span> <span class="s">&#39;arctan&#39;</span><span class="p">,</span> <span class="s">&#39;sin&#39;</span><span class="p">,</span> <span class="s">&#39;cos&#39;</span><span class="p">,</span> <span class="s">&#39;tan&#39;</span><span class="p">,</span>
                    <span class="s">&#39;sinh&#39;</span><span class="p">,</span> <span class="s">&#39;cosh&#39;</span><span class="p">,</span> <span class="s">&#39;tanh&#39;</span><span class="p">,</span> <span class="s">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s">&#39;ln&#39;</span><span class="p">,</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;sec&#39;</span><span class="p">,</span> <span class="s">&#39;csc&#39;</span><span class="p">,</span>
                    <span class="s">&#39;cot&#39;</span><span class="p">,</span> <span class="s">&#39;coth&#39;</span><span class="p">,</span> <span class="s">&#39;re&#39;</span><span class="p">,</span> <span class="s">&#39;im&#39;</span><span class="p">,</span> <span class="s">&#39;frac&#39;</span><span class="p">,</span> <span class="s">&#39;root&#39;</span><span class="p">,</span> <span class="s">&#39;arg&#39;</span><span class="p">,</span>
                    <span class="p">]</span>

<span class="n">tex_greek_dictionary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Alpha&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">,</span>
    <span class="s">&#39;Beta&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">,</span>
    <span class="s">&#39;Epsilon&#39;</span><span class="p">:</span> <span class="s">&#39;E&#39;</span><span class="p">,</span>
    <span class="s">&#39;Zeta&#39;</span><span class="p">:</span> <span class="s">&#39;Z&#39;</span><span class="p">,</span>
    <span class="s">&#39;Eta&#39;</span><span class="p">:</span> <span class="s">&#39;H&#39;</span><span class="p">,</span>
    <span class="s">&#39;Iota&#39;</span><span class="p">:</span> <span class="s">&#39;I&#39;</span><span class="p">,</span>
    <span class="s">&#39;Kappa&#39;</span><span class="p">:</span> <span class="s">&#39;K&#39;</span><span class="p">,</span>
    <span class="s">&#39;Mu&#39;</span><span class="p">:</span> <span class="s">&#39;M&#39;</span><span class="p">,</span>
    <span class="s">&#39;Nu&#39;</span><span class="p">:</span> <span class="s">&#39;N&#39;</span><span class="p">,</span>
    <span class="s">&#39;omicron&#39;</span><span class="p">:</span> <span class="s">&#39;o&#39;</span><span class="p">,</span>
    <span class="s">&#39;Omicron&#39;</span><span class="p">:</span> <span class="s">&#39;O&#39;</span><span class="p">,</span>
    <span class="s">&#39;Rho&#39;</span><span class="p">:</span> <span class="s">&#39;P&#39;</span><span class="p">,</span>
    <span class="s">&#39;Tau&#39;</span><span class="p">:</span> <span class="s">&#39;T&#39;</span><span class="p">,</span>
    <span class="s">&#39;Chi&#39;</span><span class="p">:</span> <span class="s">&#39;X&#39;</span><span class="p">,</span>
    <span class="s">&#39;lamda&#39;</span><span class="p">:</span> <span class="s">r&#39;\lambda&#39;</span><span class="p">,</span>
    <span class="s">&#39;Lamda&#39;</span><span class="p">:</span> <span class="s">r&#39;\Lambda&#39;</span><span class="p">,</span>
    <span class="s">&#39;khi&#39;</span><span class="p">:</span> <span class="s">r&#39;\chi&#39;</span><span class="p">,</span>
    <span class="s">&#39;Khi&#39;</span><span class="p">:</span> <span class="s">r&#39;X&#39;</span><span class="p">,</span>
    <span class="s">&#39;varepsilon&#39;</span><span class="p">:</span> <span class="s">r&#39;\varepsilon&#39;</span><span class="p">,</span>
    <span class="s">&#39;varkappa&#39;</span><span class="p">:</span> <span class="s">r&#39;\varkappa&#39;</span><span class="p">,</span>
    <span class="s">&#39;varphi&#39;</span><span class="p">:</span> <span class="s">r&#39;\varphi&#39;</span><span class="p">,</span>
    <span class="s">&#39;varpi&#39;</span><span class="p">:</span> <span class="s">r&#39;\varpi&#39;</span><span class="p">,</span>
    <span class="s">&#39;varrho&#39;</span><span class="p">:</span> <span class="s">r&#39;\varrho&#39;</span><span class="p">,</span>
    <span class="s">&#39;varsigma&#39;</span><span class="p">:</span> <span class="s">r&#39;\varsigma&#39;</span><span class="p">,</span>
    <span class="s">&#39;vartheta&#39;</span><span class="p">:</span> <span class="s">r&#39;\vartheta&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">other_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;aleph&#39;</span><span class="p">,</span> <span class="s">&#39;beth&#39;</span><span class="p">,</span> <span class="s">&#39;daleth&#39;</span><span class="p">,</span> <span class="s">&#39;gimel&#39;</span><span class="p">,</span> <span class="s">&#39;ell&#39;</span><span class="p">,</span> <span class="s">&#39;eth&#39;</span><span class="p">,</span> <span class="s">&#39;hbar&#39;</span><span class="p">,</span>
                     <span class="s">&#39;hslash&#39;</span><span class="p">,</span> <span class="s">&#39;mho&#39;</span><span class="p">,</span> <span class="s">&#39;wp&#39;</span><span class="p">,</span> <span class="p">])</span>

<span class="n">greek_letters_set</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">greeks</span><span class="p">)</span>

<div class="viewcode-block" id="LatexPrinter"><a class="viewcode-back" href="../../../modules/printing.html#sympy.printing.latex.LatexPrinter">[docs]</a><span class="k">class</span> <span class="nc">LatexPrinter</span><span class="p">(</span><span class="n">Printer</span><span class="p">):</span>
    <span class="n">printmethod</span> <span class="o">=</span> <span class="s">&quot;_latex&quot;</span>

    <span class="n">_default_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;order&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;mode&quot;</span><span class="p">:</span> <span class="s">&quot;plain&quot;</span><span class="p">,</span>
        <span class="s">&quot;itex&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&quot;fold_frac_powers&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&quot;fold_func_brackets&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&quot;fold_short_frac&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;long_frac_ratio&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">&quot;mul_symbol&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;inv_trig_style&quot;</span><span class="p">:</span> <span class="s">&quot;abbreviated&quot;</span><span class="p">,</span>
        <span class="s">&quot;mat_str&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">&quot;mat_delim&quot;</span><span class="p">:</span> <span class="s">&quot;[&quot;</span><span class="p">,</span>
        <span class="s">&quot;symbol_names&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Printer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;mode&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">:</span>
            <span class="n">valid_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;inline&#39;</span><span class="p">,</span> <span class="s">&#39;plain&#39;</span><span class="p">,</span> <span class="s">&#39;equation&#39;</span><span class="p">,</span>
                           <span class="s">&#39;equation*&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&#39;mode&#39; must be one of &#39;inline&#39;, &#39;plain&#39;, &quot;</span>
                    <span class="s">&quot;&#39;equation&#39; or &#39;equation*&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;fold_short_frac&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inline&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;fold_short_frac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">mul_symbol_table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">None</span><span class="p">:</span> <span class="s">r&quot; &quot;</span><span class="p">,</span>
            <span class="s">&quot;ldot&quot;</span><span class="p">:</span> <span class="s">r&quot; \,.\, &quot;</span><span class="p">,</span>
            <span class="s">&quot;dot&quot;</span><span class="p">:</span> <span class="s">r&quot; \cdot &quot;</span><span class="p">,</span>
            <span class="s">&quot;times&quot;</span><span class="p">:</span> <span class="s">r&quot; \times &quot;</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">mul_symbol_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex_numbers&#39;</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">mul_symbol_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;dot&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delim_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;(&#39;</span><span class="p">:</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">:</span> <span class="s">&#39;]&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">parenthesize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">precedence</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">level</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">doprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="n">Printer</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;plain&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inline&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;$</span><span class="si">%s</span><span class="s">$&quot;</span> <span class="o">%</span> <span class="n">tex</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;itex&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s">r&quot;$$</span><span class="si">%s</span><span class="s">$$&quot;</span> <span class="o">%</span> <span class="n">tex</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="s">r&quot;\begin{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">\end{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">env_str</span><span class="p">,</span> <span class="n">tex</span><span class="p">,</span> <span class="n">env_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_needs_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the expression needs to be wrapped in brackets when</span>
<span class="sd">        printed, False otherwise. For example: a + b =&gt; True; a =&gt; False;</span>
<span class="sd">        10 =&gt; False; -10 =&gt; True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">((</span><span class="n">expr</span><span class="o">.</span><span class="n">is_Integer</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_nonnegative</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">is_Atom</span> <span class="ow">and</span> <span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_needs_function_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the expression needs to be wrapped in brackets when</span>
<span class="sd">        passed as an argument to a function, False otherwise. This is a more</span>
<span class="sd">        liberal version of _needs_brackets, in that many expressions which need</span>
<span class="sd">        to be wrapped in brackets when added/subtracted/raised to a power do</span>
<span class="sd">        not need them when passed to a function. Such an example is a*b.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Muls of the form a*b*c... can be folded</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Mul</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul_is_clean</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="c"># Pows which don&#39;t need brackets can be folded</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pow_is_clean</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="c"># Add and Function always need brackets</span>
            <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">_needs_mul_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the expression needs to be wrapped in brackets when</span>
<span class="sd">        printed as part of a Mul, False otherwise. This is True for Add,</span>
<span class="sd">        but also for some container objects that would not need brackets</span>
<span class="sd">        when appearing last in a Mul, e.g. an Integral. ``last=True``</span>
<span class="sd">        specifies that this expr is the last to appear in a Mul.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Integral</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Sum</span>
        <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">last</span> <span class="ow">and</span>
            <span class="nb">any</span><span class="p">([</span><span class="n">expr</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Integral</span><span class="p">,</span> <span class="n">Piecewise</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Sum</span><span class="p">)]))</span>

    <span class="k">def</span> <span class="nf">_mul_is_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_pow_is_clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_exponent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr</span>

    <span class="k">def</span> <span class="nf">_print_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathrm{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_print_NoneType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathrm{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_print_Add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="s">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">terms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_ordered_terms</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_coeff_isneg</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">&quot; + &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">&quot; - &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="o">-</span><span class="n">term</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="c"># Based off of that in StrPrinter</span>
        <span class="n">dps</span> <span class="o">=</span> <span class="n">prec_to_dps</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">_prec</span><span class="p">)</span>
        <span class="n">str_real</span> <span class="o">=</span> <span class="n">mlib</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">_mpf_</span><span class="p">,</span> <span class="n">dps</span><span class="p">,</span> <span class="n">strip_zeros</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Must always have a mul symbol (as 2.5 10^{20} just looks odd)</span>
        <span class="c"># thus we use the number separator</span>
        <span class="n">separator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex_numbers&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">str_real</span><span class="p">:</span>
            <span class="p">(</span><span class="n">mant</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span> <span class="o">=</span> <span class="n">str_real</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">exp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;+&#39;</span><span class="p">:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s%s</span><span class="s">10^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mant</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">str_real</span> <span class="o">==</span> <span class="s">&quot;+inf&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\infty&quot;</span>
        <span class="k">elif</span> <span class="n">str_real</span> <span class="o">==</span> <span class="s">&quot;-inf&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;- \infty&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">str_real</span>

    <span class="k">def</span> <span class="nf">_print_Mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">coeff</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">as_coeff_Mul</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">coeff</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="o">-</span><span class="n">expr</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">&quot;- &quot;</span>

        <span class="kn">from</span> <span class="nn">sympy.simplify</span> <span class="kn">import</span> <span class="n">fraction</span>
        <span class="n">numer</span><span class="p">,</span> <span class="n">denom</span> <span class="o">=</span> <span class="n">fraction</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">separator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex&#39;</span><span class="p">]</span>
        <span class="n">numbersep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex_numbers&#39;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_tex</span> <span class="o">=</span> <span class="n">last_term_tex</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;old&#39;</span><span class="p">,</span> <span class="s">&#39;none&#39;</span><span class="p">):</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">as_ordered_factors</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                    <span class="n">term_tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_mul_brackets</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)):</span>
                        <span class="n">term_tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="n">term_tex</span>

                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;[0-9][} ]*$&quot;</span><span class="p">,</span> <span class="n">last_term_tex</span><span class="p">)</span> <span class="ow">and</span> \
                            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[{ ]*[-+0-9]&quot;</span><span class="p">,</span> <span class="n">term_tex</span><span class="p">):</span>
                        <span class="c"># between two numbers</span>
                        <span class="n">_tex</span> <span class="o">+=</span> <span class="n">numbersep</span>
                    <span class="k">elif</span> <span class="n">_tex</span><span class="p">:</span>
                        <span class="n">_tex</span> <span class="o">+=</span> <span class="n">separator</span>

                    <span class="n">_tex</span> <span class="o">+=</span> <span class="n">term_tex</span>
                    <span class="n">last_term_tex</span> <span class="o">=</span> <span class="n">term_tex</span>
                <span class="k">return</span> <span class="n">_tex</span>

        <span class="k">if</span> <span class="n">denom</span> <span class="ow">is</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="n">convert</span><span class="p">(</span><span class="n">numer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">snumer</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">numer</span><span class="p">)</span>
            <span class="n">sdenom</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
            <span class="n">ldenom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sdenom</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;long_frac_ratio&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;fold_short_frac&#39;</span><span class="p">]</span> \
                    <span class="ow">and</span> <span class="n">ldenom</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&quot;^&quot;</span> <span class="ow">in</span> <span class="n">sdenom</span><span class="p">:</span>
                <span class="c"># handle short fractions</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_mul_brackets</span><span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right) / </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">snumer</span><span class="p">,</span> <span class="n">sdenom</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> / </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">snumer</span><span class="p">,</span> <span class="n">sdenom</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">snumer</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">ratio</span><span class="o">*</span><span class="n">ldenom</span><span class="p">:</span>
                <span class="c"># handle long fractions</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_mul_brackets</span><span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\frac{1}{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> \
                        <span class="o">%</span> <span class="p">(</span><span class="n">sdenom</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">snumer</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">numer</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
                    <span class="c"># split a long numerator</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">One</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numer</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_mul_brackets</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="ow">or</span> \
                                <span class="nb">len</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">ratio</span><span class="o">*</span><span class="n">ldenom</span> <span class="ow">or</span> \
                                <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">is_commutative</span> <span class="ow">is</span> <span class="n">x</span><span class="o">.</span><span class="n">is_commutative</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">):</span>
                            <span class="n">b</span> <span class="o">*=</span> <span class="n">x</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">a</span> <span class="o">*=</span> <span class="n">x</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_mul_brackets</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                        <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sdenom</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">convert</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s%s</span><span class="s">&quot;</span> \
                            <span class="o">%</span> <span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">sdenom</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">convert</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\frac{1}{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sdenom</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="n">snumer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">snumer</span><span class="p">,</span> <span class="n">sdenom</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="c"># Treat x**Rational(1,n) as special case</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">q</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
            <span class="n">expq</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">q</span>

            <span class="k">if</span> <span class="n">expq</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\sqrt{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">base</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;itex&#39;</span><span class="p">]:</span>
                <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\root{</span><span class="si">%d</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expq</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\sqrt[</span><span class="si">%d</span><span class="s">]{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expq</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_negative</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">r&quot;\frac{1}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">tex</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tex</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;fold_frac_powers&#39;</span><span class="p">]</span> \
            <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Rational</span> \
                <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">q</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">base</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">),</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">q</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_Rational</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">is_negative</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">is_commutative</span><span class="p">:</span>
            <span class="c"># Things like 1/x</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Mul</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_commutative</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c">#solves issue 1030</span>
                    <span class="c">#As Mul always simplify 1/x to x**-1</span>
                    <span class="c">#The objective is achieved with this hack</span>
                    <span class="c">#first we get the latex for -1 * expr,</span>
                    <span class="c">#which is a Mul expression</span>
                    <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">NegativeOne</span> <span class="o">*</span> <span class="n">expr</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="c">#the result comes with a minus and a space, so we remove</span>
                    <span class="k">if</span> <span class="n">tex</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">tex</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">):</span>
                    <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span>

                <span class="k">return</span> <span class="n">tex</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\sum_{</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">} &quot;</span> <span class="o">%</span> \
                <span class="nb">tuple</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_format_ineq</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> \leq </span><span class="si">%s</span><span class="s"> \leq </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                    <span class="nb">tuple</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>

            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\sum_{\substack{</span><span class="si">%s</span><span class="s">}} &quot;</span> <span class="o">%</span> \
                <span class="nb">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">_format_ineq</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span> <span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\prod_{</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">} &quot;</span> <span class="o">%</span> \
                <span class="nb">tuple</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">_format_ineq</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> \leq </span><span class="si">%s</span><span class="s"> \leq </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                    <span class="nb">tuple</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>

            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\prod_{\substack{</span><span class="si">%s</span><span class="s">}} &quot;</span> <span class="o">%</span> \
                <span class="nb">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="n">_format_ineq</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span> <span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">Add</span><span class="p">):</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">requires_partial</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
            <span class="n">diff_symbol</span> <span class="o">=</span> <span class="s">r&#39;\partial&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">diff_symbol</span> <span class="o">=</span> <span class="s">r&#39;d&#39;</span>


        <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">diff_symbol</span><span class="p">,</span> <span class="n">diff_symbol</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multiplicity</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tex</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">current</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                    <span class="n">current</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multiplicity</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">multiplicity</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">diff_symbol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">diff_symbol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span>

            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}}{</span><span class="si">%s</span><span class="s">} &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">diff_symbol</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AssocOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Subs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subs</span><span class="p">):</span>
        <span class="n">expr</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="o">=</span> <span class="n">subs</span><span class="o">.</span><span class="n">args</span>
        <span class="n">latex_expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">latex_old</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">old</span><span class="p">)</span>
        <span class="n">latex_new</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">new</span><span class="p">)</span>
        <span class="n">latex_subs</span> <span class="o">=</span> <span class="s">r&#39;</span><span class="se">\\</span><span class="s"> &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">latex_old</span><span class="p">,</span> <span class="n">latex_new</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">r&#39;\left. </span><span class="si">%s</span><span class="s"> \right|_{\substack{ </span><span class="si">%s</span><span class="s"> }}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">latex_expr</span><span class="p">,</span> <span class="n">latex_subs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">tex</span><span class="p">,</span> <span class="n">symbols</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">[]</span>

        <span class="c"># Only up to \iiiint exists</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">):</span>
            <span class="c"># Use len(expr.limits)-1 so that syntax highlighters don&#39;t think</span>
            <span class="c"># \&quot; is an escaped quote</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\i&quot;</span> <span class="o">+</span> <span class="s">&quot;i&quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;nt&quot;</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&quot;\, d</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbol</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lim</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">limits</span><span class="p">):</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\int&quot;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;equation&#39;</span><span class="p">,</span> <span class="s">&#39;equation*&#39;</span><span class="p">]</span> \
                            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;itex&#39;</span><span class="p">]:</span>
                        <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot;\limits&quot;</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">tex</span> <span class="o">+=</span> <span class="s">&quot;_{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">tex</span> <span class="o">+=</span> <span class="s">&quot;^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

                <span class="n">symbols</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">r&quot;\, d</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>

        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">function</span><span class="p">)),</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">e</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span>

        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\lim_{</span><span class="si">%s</span><span class="s"> \to </span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">z0</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">AssocOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_hprint_Function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Logic to decide how to render a function to latex</span>
<span class="sd">          - if it is a recognized latex name, use the appropriate latex command</span>
<span class="sd">          - if it is a single letter, just use that letter</span>
<span class="sd">          - if it is a longer name, then put \operatorname{} around it and be</span>
<span class="sd">            mindful of undercores in the name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">r&quot;\</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">func</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">func</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">r&quot;\operatorname{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">func</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="s">r&quot;\_&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_print_Function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Render functions to LaTeX, handling functions that LaTeX knows about</span>
<span class="sd">        e.g., sin, cos, ... by using the proper LaTeX command (\sin, \cos, ...).</span>
<span class="sd">        For single-letter function names, render them as regular LaTeX math</span>
<span class="sd">        symbols. For multi-letter function names that LaTeX does not know</span>
<span class="sd">        about, (e.g., Li, sech) use \operatorname{} so that the function name</span>
<span class="sd">        is rendered in Roman font and LaTeX handles spacing properly.</span>

<span class="sd">        expr is the expression involving the function</span>
<span class="sd">        exp is an exponent</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_print_&#39;</span> <span class="o">+</span> <span class="n">func</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_print_&#39;</span> <span class="o">+</span> <span class="n">func</span><span class="p">)(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span> <span class="p">]</span>
            <span class="c"># How inverse trig functions should be displayed, formats are:</span>
            <span class="c"># abbreviated: asin, full: arcsin, power: sin^-1</span>
            <span class="n">inv_trig_style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;inv_trig_style&#39;</span><span class="p">]</span>
            <span class="c"># If we are dealing with a power-style inverse trig function</span>
            <span class="n">inv_trig_power_case</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c"># If it is applicable to fold the argument brackets</span>
            <span class="n">can_fold_brackets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;fold_func_brackets&#39;</span><span class="p">]</span> <span class="ow">and</span> \
                <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> \
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_function_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">inv_trig_table</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;asin&quot;</span><span class="p">,</span> <span class="s">&quot;acos&quot;</span><span class="p">,</span> <span class="s">&quot;atan&quot;</span><span class="p">,</span> <span class="s">&quot;acot&quot;</span><span class="p">]</span>

            <span class="c"># If the function is an inverse trig function, handle the style</span>
            <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">inv_trig_table</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inv_trig_style</span> <span class="o">==</span> <span class="s">&quot;abbreviated&quot;</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
                <span class="k">elif</span> <span class="n">inv_trig_style</span> <span class="o">==</span> <span class="s">&quot;full&quot;</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="s">&quot;arc&quot;</span> <span class="o">+</span> <span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">elif</span> <span class="n">inv_trig_style</span> <span class="o">==</span> <span class="s">&quot;power&quot;</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">inv_trig_power_case</span> <span class="o">=</span> <span class="bp">True</span>

                    <span class="c"># Can never fold brackets if we&#39;re raised to a power</span>
                    <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">can_fold_brackets</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">inv_trig_power_case</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s">r&quot;\</span><span class="si">%s</span><span class="s">^{-1}&quot;</span> <span class="o">%</span> <span class="n">func</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s">r&quot;\operatorname{</span><span class="si">%s</span><span class="s">}^{-1}&quot;</span> <span class="o">%</span> <span class="n">func</span>
            <span class="k">elif</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">r&#39;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hprint_Function</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="n">exp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_Function</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">can_fold_brackets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
                    <span class="c"># Wrap argument safely to avoid parse-time conflicts</span>
                    <span class="c"># with the function name itself</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="s">r&quot; {</span><span class="si">%s</span><span class="s">}&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">r&quot;{\left (</span><span class="si">%s</span><span class="s"> \right )}&quot;</span>

            <span class="k">if</span> <span class="n">inv_trig_power_case</span> <span class="ow">and</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s">r&quot;^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">exp</span>

            <span class="k">return</span> <span class="n">name</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_UndefinedFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_Function</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_FunctionClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s">&#39;_latex_no_arg&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">expr</span><span class="o">.</span><span class="n">_latex_no_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_Function</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Lambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">symbols</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\Lambda {\left (</span><span class="si">%s</span><span class="s"> \right )}&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">texargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\min\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">texargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">texargs</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\max\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">texargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\lfloor{</span><span class="si">%s</span><span class="s">}\rfloor&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_ceiling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\lceil{</span><span class="si">%s</span><span class="s">}\rceil&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left\lvert{</span><span class="si">%s</span><span class="s">}\right\rvert&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>
    <span class="n">_print_Determinant</span> <span class="o">=</span> <span class="n">_print_Abs</span>

    <span class="k">def</span> <span class="nf">_print_re</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\Re {\left (</span><span class="si">%s</span><span class="s"> \right )}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\Re{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_im</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\Im {\left ( </span><span class="si">%s</span><span class="s"> \right )}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\Im{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Not</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_Boolean</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;\neg (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\neg </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_And</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot; \wedge \left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot; \wedge </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Boolean</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Not</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot; \vee \left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">+=</span> <span class="s">r&quot; \vee </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Implies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> \Rightarrow </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_Equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> \Leftrightarrow </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_conjugate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\overline{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_ExpBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># TODO should exp_polar be printed differently?</span>
        <span class="c">#      what about exp_polar(0), exp_polar(1)?</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;e^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;K^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;K</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\middle| </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;F^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;F</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_e</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\middle| </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;E^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;E</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_elliptic_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">; </span><span class="si">%s</span><span class="s">\middle| </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\middle| </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Pi^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Pi</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Gamma^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Gamma</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_uppergamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Gamma^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Gamma</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_lowergamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\gamma^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\gamma</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_expint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\operatorname{E}_{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\operatorname{E}_{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_subfactorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;!\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">&quot;!&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_factorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)!&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;!&quot;</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_factorial2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needs_brackets</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)!!&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;!!&quot;</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_binomial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{\binom{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_RisingFactorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{\left(</span><span class="si">%s</span><span class="s">\right)}^{\left(</span><span class="si">%s</span><span class="s">\right)}&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FallingFactorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{\left(</span><span class="si">%s</span><span class="s">\right)}_{\left(</span><span class="si">%s</span><span class="s">\right)}&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hprint_BesselBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sym</span><span class="p">)</span>

        <span class="n">need_exp</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tex</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;^&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">need_exp</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">order</span><span class="p">),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">argument</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">need_exp</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_exponent</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_hprint_vec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">vec</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">, &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_print_besselj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;J&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_besseli</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_besselk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;K&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_bessely</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;Y&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_yn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_jn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;j&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_hankel1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;H^{(1)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_hankel2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_BesselBase</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="s">&#39;H^{(2)}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_fresnels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;S^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;S</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_fresnelc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;C^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;C</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_hyper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{{}_{</span><span class="si">%s</span><span class="s">}F_{</span><span class="si">%s</span><span class="s">}\left(\begin{matrix} </span><span class="si">%s</span><span class="s"> </span><span class="se">\\</span><span class="s"> </span><span class="si">%s</span><span class="s"> \end{matrix}&quot;</span> \
              <span class="s">r&quot;\middle| {</span><span class="si">%s</span><span class="s">} \right)}&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ap</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bq</span><span class="p">)),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ap</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bq</span><span class="p">),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">argument</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_meijerg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{G_{</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">}\left(\begin{matrix} </span><span class="si">%s</span><span class="s"> &amp; </span><span class="si">%s</span><span class="s"> </span><span class="se">\\</span><span class="s">&quot;</span> \
              <span class="s">r&quot;</span><span class="si">%s</span><span class="s"> &amp; </span><span class="si">%s</span><span class="s"> \end{matrix} \middle| {</span><span class="si">%s</span><span class="s">} \right)}&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">ap</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bq</span><span class="p">)),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bm</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">an</span><span class="p">)),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">an</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">aother</span><span class="p">),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bm</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hprint_vec</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">bother</span><span class="p">),</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">argument</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_dirichlet_eta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\eta^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">r&quot;\eta</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_zeta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\zeta^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">r&quot;\zeta</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_lerchphi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\Phi</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">tex</span>
        <span class="k">return</span> <span class="s">r&quot;\Phi^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">tex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_polylog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="n">z</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\operatorname{Li}_{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">tex</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">r&quot;\operatorname{Li}_{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">),</span> <span class="n">tex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_jacobi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;P_{</span><span class="si">%s</span><span class="s">}^{\left(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">\right)}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_gegenbauer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;C_{</span><span class="si">%s</span><span class="s">}^{\left(</span><span class="si">%s</span><span class="s">\right)}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_chebyshevt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;T_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_chebyshevu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;U_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_legendre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;P_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_assoc_legendre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;P_{</span><span class="si">%s</span><span class="s">}^{\left(</span><span class="si">%s</span><span class="s">\right)}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_hermite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;H_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_laguerre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;L_{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_assoc_laguerre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;L_{</span><span class="si">%s</span><span class="s">}^{\left(</span><span class="si">%s</span><span class="s">\right)}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Ynm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;Y_{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Znm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;Z_{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}\left(</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(&quot;</span> <span class="o">+</span> <span class="n">tex</span> <span class="o">+</span> <span class="s">r&quot;\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Rational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">q</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">p</span>
            <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="s">&quot;- &quot;</span>
                <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span>
            <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">\frac{</span><span class="si">%d</span><span class="s">}{</span><span class="si">%d</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">point</span> <span class="o">!=</span> <span class="n">S</span><span class="o">.</span><span class="n">Zero</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;; &#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">r&#39;\rightarrow&#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">point</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{O}\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_print_Symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;symbol_names&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;symbol_names&#39;</span><span class="p">][</span><span class="n">expr</span><span class="p">]</span>

        <span class="n">name</span><span class="p">,</span> <span class="n">supers</span><span class="p">,</span> <span class="n">subs</span> <span class="o">=</span> <span class="n">split_super_sub</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">supers</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="p">(</span><span class="n">sup</span><span class="p">)</span> <span class="k">for</span> <span class="n">sup</span> <span class="ow">in</span> <span class="n">supers</span><span class="p">]</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[</span><span class="n">translate</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">]</span>

        <span class="c"># glue all items together:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">supers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&quot;^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">+=</span> <span class="s">&quot;_{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">name</span>
    <span class="n">_print_RandomSymbol</span> <span class="o">=</span> <span class="n">_print_Symbol</span>
    <span class="n">_print_MatrixSymbol</span> <span class="o">=</span> <span class="n">_print_Symbol</span>

    <span class="k">def</span> <span class="nf">_print_Relational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;itex&#39;</span><span class="p">]:</span>
            <span class="n">gt</span> <span class="o">=</span> <span class="s">r&quot;\gt&quot;</span>
            <span class="n">lt</span> <span class="o">=</span> <span class="s">r&quot;\lt&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gt</span> <span class="o">=</span> <span class="s">&quot;&gt;&quot;</span>
            <span class="n">lt</span> <span class="o">=</span> <span class="s">&quot;&lt;&quot;</span>

        <span class="n">charmap</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;==&quot;</span><span class="p">:</span> <span class="s">&quot;=&quot;</span><span class="p">,</span>
            <span class="s">&quot;&gt;&quot;</span><span class="p">:</span> <span class="n">gt</span><span class="p">,</span>
            <span class="s">&quot;&lt;&quot;</span><span class="p">:</span> <span class="n">lt</span><span class="p">,</span>
            <span class="s">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="s">r&quot;\geq&quot;</span><span class="p">,</span>
            <span class="s">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="s">r&quot;\leq&quot;</span><span class="p">,</span>
            <span class="s">&quot;!=&quot;</span><span class="p">:</span> <span class="s">r&quot;\neq&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">lhs</span><span class="p">),</span>
            <span class="n">charmap</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">rel_op</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">rhs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Piecewise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">ecpairs</span> <span class="o">=</span> <span class="p">[</span><span class="s">r&quot;</span><span class="si">%s</span><span class="s"> &amp; \text{for}\: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                   <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cond</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">ecpairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">r&quot;</span><span class="si">%s</span><span class="s"> &amp; \text{otherwise}&quot;</span> <span class="o">%</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ecpairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">r&quot;</span><span class="si">%s</span><span class="s"> &amp; \text{for}\: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cond</span><span class="p">)))</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\begin{cases} </span><span class="si">%s</span><span class="s"> \end{cases}&quot;</span>
        <span class="k">return</span> <span class="n">tex</span> <span class="o">%</span> <span class="s">r&quot; </span><span class="se">\\</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ecpairs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatrixBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>  <span class="c"># horrible, should be &#39;rows&#39;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="p">:]</span> <span class="p">]))</span>

        <span class="n">mat_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mat_str&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mat_str</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;inline&#39;</span><span class="p">:</span>
                <span class="n">mat_str</span> <span class="o">=</span> <span class="s">&#39;smallmatrix&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">cols</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">mat_str</span> <span class="o">=</span> <span class="s">&#39;matrix&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mat_str</span> <span class="o">=</span> <span class="s">&#39;array&#39;</span>

        <span class="n">out_str</span> <span class="o">=</span> <span class="s">r&#39;\begin{%MATSTR%}</span><span class="si">%s</span><span class="s">\end{%MATSTR%}&#39;</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="n">out_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;%MATSTR%&#39;</span><span class="p">,</span> <span class="n">mat_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mat_str</span> <span class="o">==</span> <span class="s">&#39;array&#39;</span><span class="p">:</span>
            <span class="n">out_str</span> <span class="o">=</span> <span class="n">out_str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="s">&#39;c&#39;</span><span class="o">*</span><span class="n">expr</span><span class="o">.</span><span class="n">cols</span> <span class="o">+</span> <span class="s">&#39;}</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mat_delim&#39;</span><span class="p">]:</span>
            <span class="n">left_delim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mat_delim&#39;</span><span class="p">]</span>
            <span class="n">right_delim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delim_dict</span><span class="p">[</span><span class="n">left_delim</span><span class="p">]</span>
            <span class="n">out_str</span> <span class="o">=</span> <span class="s">r&#39;\left&#39;</span> <span class="o">+</span> <span class="n">left_delim</span> <span class="o">+</span> <span class="n">out_str</span> <span class="o">+</span> \
                      <span class="s">r&#39;\right&#39;</span> <span class="o">+</span> <span class="n">right_delim</span>
        <span class="k">return</span> <span class="n">out_str</span> <span class="o">%</span> <span class="s">r&quot;</span><span class="se">\\</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">_print_ImmutableMatrix</span> <span class="o">=</span> <span class="n">_print_MatrixBase</span>
    <span class="n">_print_Matrix</span> <span class="o">=</span> <span class="n">_print_MatrixBase</span>

    <span class="k">def</span> <span class="nf">_print_MatrixElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;_{</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">}&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatrixSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">latexslice</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">return</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span> <span class="o">+</span> <span class="s">r&#39;\left[&#39;</span> <span class="o">+</span>
                <span class="n">latexslice</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">rowslice</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span> <span class="o">+</span>
                <span class="n">latexslice</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">colslice</span><span class="p">)</span> <span class="o">+</span> <span class="s">r&#39;\right]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_BlockMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">blocks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">arg</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^T&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">^T&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Adjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">arg</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^\dag&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">^\dag&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_MatAdd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">terms</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_MatMul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">HadamardProduct</span>

        <span class="k">def</span> <span class="nf">parens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">HadamardProduct</span><span class="p">)):</span>
                <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">parens</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_HadamardProduct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">MatMul</span>

        <span class="k">def</span> <span class="nf">parens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">Add</span><span class="p">,</span> <span class="n">MatAdd</span><span class="p">,</span> <span class="n">MatMul</span><span class="p">)):</span>
                <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39; \circ &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">parens</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_MatPow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">exp</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span>
        <span class="kn">from</span> <span class="nn">sympy.matrices</span> <span class="kn">import</span> <span class="n">MatrixSymbol</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">MatrixSymbol</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">exp</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_ZeroMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\bold{0}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_Identity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{I}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\begin{pmatrix}</span><span class="si">%s</span><span class="s">\end{pmatrix}&quot;</span> <span class="o">%</span> \
            <span class="s">r&quot;, &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span> <span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_Tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_tuple</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\begin{bmatrix}</span><span class="si">%s</span><span class="s">\end{bmatrix}&quot;</span> <span class="o">%</span> \
            <span class="s">r&quot;, &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">expr</span> <span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>

        <span class="k">return</span> <span class="s">r&quot;\begin{Bmatrix}</span><span class="si">%s</span><span class="s">\end{Bmatrix}&quot;</span> <span class="o">%</span> <span class="s">r&quot;, &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_dict</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_DiracDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\delta\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\delta^{\left( </span><span class="si">%s</span><span class="s"> \right)}\left( </span><span class="si">%s</span><span class="s"> \right)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_Heaviside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\theta\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_KroneckerDelta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_Atom</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\delta_{</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\delta_{</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_LeviCivita</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">is_Atom</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">)):</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\varepsilon_{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\varepsilon_{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exp</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&#39;\left(</span><span class="si">%s</span><span class="s">\right)^{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">exp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_ProductSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_variety</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;^</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot; \times &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span> <span class="k">for</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">sets</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_RandomDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;Domain: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">as_boolean</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="s">&#39;Domain: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; in &#39;</span> <span class="o">+</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">set</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;Domain on &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">symbols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FiniteSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_set</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">default_sort_key</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">items</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">r&quot;\left\{</span><span class="si">%s</span><span class="s">\right\}&quot;</span> <span class="o">%</span> <span class="n">items</span>

    <span class="n">_print_frozenset</span> <span class="o">=</span> <span class="n">_print_set</span>

    <span class="k">def</span> <span class="nf">_print_Range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">printset</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">),</span> <span class="nb">next</span><span class="p">(</span><span class="n">it</span><span class="p">),</span> <span class="s">&#39;\ldots&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">_last_element</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">printset</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="s">r&quot;\left\{&quot;</span>
              <span class="o">+</span> <span class="s">r&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">printset</span><span class="p">)</span>
              <span class="o">+</span> <span class="s">r&quot;\right\}&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\left\{</span><span class="si">%s</span><span class="s">\right\}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">left_open</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">left</span> <span class="o">=</span> <span class="s">&#39;[&#39;</span>

            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">right_open</span><span class="p">:</span>
                <span class="n">right</span> <span class="o">=</span> <span class="s">&#39;)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">right</span> <span class="o">=</span> <span class="s">&#39;]&#39;</span>

            <span class="k">return</span> <span class="s">r&quot;\left</span><span class="si">%s%s</span><span class="s">, </span><span class="si">%s</span><span class="s">\right</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                   <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">right</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot; \cup &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_Intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot; \cap &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_EmptySet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\emptyset&quot;</span>

    <span class="k">def</span> <span class="nf">_print_Naturals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{N}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_Integers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{Z}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_Reals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{R}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_TransformationSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\left\{</span><span class="si">%s</span><span class="s">\; |\; </span><span class="si">%s</span><span class="s"> \in </span><span class="si">%s</span><span class="s">\right\}&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">expr</span><span class="p">),</span>
            <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">variables</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">base_set</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_FiniteField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{F}_{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="n">expr</span><span class="o">.</span><span class="n">mod</span>

    <span class="k">def</span> <span class="nf">_print_IntegerRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{Z}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_RationalField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{Q}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_RealField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{R}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_ComplexField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathbb{C}&quot;</span>

    <span class="k">def</span> <span class="nf">_print_PolynomialRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">symbols</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">\left[</span><span class="si">%s</span><span class="s">\right]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FractionField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">symbols</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s</span><span class="s">\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_PolynomialRingBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">symbols</span><span class="p">))</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Poly</span><span class="p">:</span>
            <span class="n">inv</span> <span class="o">=</span> <span class="s">r&quot;S_&lt;^{-1}&quot;</span>
        <span class="k">return</span> <span class="s">r&quot;</span><span class="si">%s%s</span><span class="s">\left[</span><span class="si">%s</span><span class="s">\right]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">inv</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">as_expr</span><span class="p">())</span>
        <span class="n">gens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">,</span> <span class="n">poly</span><span class="o">.</span><span class="n">gens</span><span class="p">))</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="s">&quot;domain=</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">get_domain</span><span class="p">())</span>

        <span class="n">args</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">expr</span><span class="p">]</span> <span class="o">+</span> <span class="n">gens</span> <span class="o">+</span> <span class="p">[</span><span class="n">domain</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\</span><span class="si">%s</span><span class="s"> {\left (</span><span class="si">%s</span><span class="s"> \right )}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="s">r&quot;\operatorname{</span><span class="si">%s</span><span class="s">}{\left( </span><span class="si">%s</span><span class="s"> \right)}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tex</span>

    <span class="k">def</span> <span class="nf">_print_RootOf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">index</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\</span><span class="si">%s</span><span class="s"> {\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">\right)}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\operatorname{</span><span class="si">%s</span><span class="s">} {\left(</span><span class="si">%s</span><span class="s">, </span><span class="si">%d</span><span class="s">\right)}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_RootSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">expr</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">expr</span><span class="o">.</span><span class="n">fun</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">IdentityFunction</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">fun</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">accepted_latex_functions</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\</span><span class="si">%s</span><span class="s"> {\left(</span><span class="si">%s</span><span class="s">\right)}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">r&quot;\operatorname{</span><span class="si">%s</span><span class="s">} {\left(</span><span class="si">%s</span><span class="s">\right)}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_PolyElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="n">mul_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings</span><span class="p">[</span><span class="s">&#39;mul_symbol_latex&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">poly</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PRECEDENCE</span><span class="p">,</span> <span class="s">&quot;{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%d</span><span class="s">}&quot;</span><span class="p">,</span> <span class="n">mul_symbol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_FracElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">frac</span><span class="o">.</span><span class="n">denom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">frac</span><span class="o">.</span><span class="n">numer</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">frac</span><span class="o">.</span><span class="n">numer</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">frac</span><span class="o">.</span><span class="n">denom</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">numer</span><span class="p">,</span> <span class="n">denom</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_euler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;E_{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_catalan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;C_{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_print_MellinTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{M}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_InverseMellinTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{M}^{-1}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_LaplaceTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{L}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_InverseLaplaceTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{L}^{-1}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_FourierTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{F}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_InverseFourierTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{F}^{-1}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_SineTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{SIN}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_InverseSineTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{SIN}^{-1}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_CosineTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{COS}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_InverseCosineTransform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\mathcal{COS}^{-1}_{</span><span class="si">%s</span><span class="s">}\left[</span><span class="si">%s</span><span class="s">\right]\left(</span><span class="si">%s</span><span class="s">\right)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_print_DMP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># TODO incorporate order</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">SympifyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_DMF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_DMP</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_Object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Morphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">codomain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">codomain</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\\</span><span class="s">rightarrow </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">codomain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_NamedMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="n">pretty_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">pretty_morphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Morphism</span><span class="p">(</span><span class="n">morphism</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pretty_name</span><span class="p">,</span> <span class="n">pretty_morphism</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_IdentityMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">sympy.categories</span> <span class="kn">import</span> <span class="n">NamedMorphism</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_NamedMorphism</span><span class="p">(</span><span class="n">NamedMorphism</span><span class="p">(</span>
            <span class="n">morphism</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span> <span class="n">morphism</span><span class="o">.</span><span class="n">codomain</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_CompositeMorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="c"># All components of the morphism have names and it is thus</span>
        <span class="c"># possible to build the name of the composite.</span>
        <span class="n">component_names_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="k">for</span>
                                <span class="n">component</span> <span class="ow">in</span> <span class="n">morphism</span><span class="o">.</span><span class="n">components</span><span class="p">]</span>
        <span class="n">component_names_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">component_names</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">circ &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">component_names_list</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span>

        <span class="n">pretty_morphism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_Morphism</span><span class="p">(</span><span class="n">morphism</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">component_names</span> <span class="o">+</span> <span class="n">pretty_morphism</span>

    <span class="k">def</span> <span class="nf">_print_Category</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">morphism</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">mathbf{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">morphism</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diagram</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diagram</span><span class="o">.</span><span class="n">premises</span><span class="p">:</span>
            <span class="c"># This is an empty diagram.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">EmptySet</span><span class="p">)</span>

        <span class="n">latex_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">diagram</span><span class="o">.</span><span class="n">premises</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diagram</span><span class="o">.</span><span class="n">conclusions</span><span class="p">:</span>
            <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">Longrightarrow </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">diagram</span><span class="o">.</span><span class="n">conclusions</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">latex_result</span>

    <span class="k">def</span> <span class="nf">_print_DiagramGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="n">latex_result</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">begin{array}{</span><span class="si">%s</span><span class="s">}</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;c&quot;</span> <span class="o">*</span> <span class="n">grid</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">height</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                    <span class="n">latex_result</span> <span class="o">+=</span> <span class="n">latex</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot; &quot;</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">grid</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot;&amp; &quot;</span>

            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">grid</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\\\\</span><span class="s">&quot;</span>
            <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="n">latex_result</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">end{array}</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">latex_result</span>

    <span class="k">def</span> <span class="nf">_print_FreeModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;{</span><span class="si">%s</span><span class="s">}^{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">ring</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rank</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_FreeModuleElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="c"># Print as row vector for convenience, for now.</span>
        <span class="k">return</span> <span class="s">r&quot;\left[ </span><span class="si">%s</span><span class="s"> \right]&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_SubModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\left&lt; </span><span class="si">%s</span><span class="s"> \right&gt;&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">gens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_ModuleImplementedIdeal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;\left&lt; </span><span class="si">%s</span><span class="s"> \right&gt;&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s">&#39;{&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;}&#39;</span> <span class="k">for</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">_module</span><span class="o">.</span><span class="n">gens</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_QuotientRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="c"># TODO nicer fractions for few generators...</span>
        <span class="k">return</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">ring</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">base_ideal</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_QuotientRingElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;{</span><span class="si">%s</span><span class="s">} + {</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">base_ideal</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_QuotientModuleElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;{</span><span class="si">%s</span><span class="s">} + {</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">killed_module</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_QuotientModule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
        <span class="c"># TODO nicer fractions for few generators...</span>
        <span class="k">return</span> <span class="s">r&quot;\frac{</span><span class="si">%s</span><span class="s">}{</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">base</span><span class="p">),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">killed_module</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_MatrixHomomorphism</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&quot;{</span><span class="si">%s</span><span class="s">} : {</span><span class="si">%s</span><span class="s">} \to {</span><span class="si">%s</span><span class="s">}&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">_sympy_matrix</span><span class="p">()),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">domain</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">codomain</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_BaseScalarField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">r&#39;\boldsymbol{\mathrm{</span><span class="si">%s</span><span class="s">}}&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_BaseVectorField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">r&#39;\partial_{</span><span class="si">%s</span><span class="s">}&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_print_Differential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diff</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">_form_field</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s">&#39;_coord_sys&#39;</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">_coord_sys</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
            <span class="k">return</span> <span class="s">r&#39;\mathrm{d}</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">Symbol</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;d(</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">r&#39;\mathrm{d}\left(</span><span class="si">%s</span><span class="s">\right)&#39;</span> <span class="o">%</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">_print_Tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="c">#Todo: Handle indices</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">r&#39;\mbox{Tr}\left(</span><span class="si">%s</span><span class="s">\right)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_totient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">r&#39;\phi\left( </span><span class="si">%s</span><span class="s"> \right)&#39;</span> <span class="o">%</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_print</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</div>
<span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given a description of a Greek letter or other special character,</span>
<span class="sd">    return the appropriate latex</span>

<span class="sd">    let everything else pass as given</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">tex</span> <span class="o">=</span> <span class="n">tex_greek_dictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tex</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tex</span>
    <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">greek_letters_set</span> <span class="ow">or</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">other_symbols</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="latex"><a class="viewcode-back" href="../../../modules/printing.html#sympy.printing.latex.latex">[docs]</a><span class="k">def</span> <span class="nf">latex</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Convert the given expression to LaTeX representation.</span>

<span class="sd">    &gt;&gt;&gt; from sympy import latex, pi, sin, asin, Integral, Matrix, Rational</span>
<span class="sd">    &gt;&gt;&gt; from sympy.abc import x, y, mu, r, tau</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**Rational(7,2)))</span>
<span class="sd">    8 \sqrt{2} \tau^{\frac{7}{2}}</span>

<span class="sd">    order: Any of the supported monomial orderings (currently &quot;lex&quot;, &quot;grlex&quot;, or</span>
<span class="sd">    &quot;grevlex&quot;), &quot;old&quot;, and &quot;none&quot;. This parameter does nothing for Mul objects.</span>
<span class="sd">    Setting order to &quot;old&quot; uses the compatibility ordering for Add defined in</span>
<span class="sd">    Printer. For very large expressions, set the &#39;order&#39; keyword to &#39;none&#39; if</span>
<span class="sd">    speed is a concern.</span>

<span class="sd">    mode: Specifies how the generated code will be delimited. &#39;mode&#39; can be one</span>
<span class="sd">    of &#39;plain&#39;, &#39;inline&#39;, &#39;equation&#39; or &#39;equation*&#39;.  If &#39;mode&#39; is set to</span>
<span class="sd">    &#39;plain&#39;, then the resulting code will not be delimited at all (this is the</span>
<span class="sd">    default). If &#39;mode&#39; is set to &#39;inline&#39; then inline LaTeX $ $ will be used.</span>
<span class="sd">    If &#39;mode&#39; is set to &#39;equation&#39; or &#39;equation*&#39;, the resulting code will be</span>
<span class="sd">    enclosed in the &#39;equation&#39; or &#39;equation*&#39; environment (remember to import</span>
<span class="sd">    &#39;amsmath&#39; for &#39;equation*&#39;), unless the &#39;itex&#39; option is set. In the latter</span>
<span class="sd">    case, the ``$$ $$`` syntax is used.</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*mu)**Rational(7,2), mode=&#39;plain&#39;))</span>
<span class="sd">    8 \sqrt{2} \mu^{\frac{7}{2}}</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**Rational(7,2), mode=&#39;inline&#39;))</span>
<span class="sd">    $8 \sqrt{2} \tau^{\frac{7}{2}}$</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*mu)**Rational(7,2), mode=&#39;equation*&#39;))</span>
<span class="sd">    \begin{equation*}8 \sqrt{2} \mu^{\frac{7}{2}}\end{equation*}</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*mu)**Rational(7,2), mode=&#39;equation&#39;))</span>
<span class="sd">    \begin{equation}8 \sqrt{2} \mu^{\frac{7}{2}}\end{equation}</span>

<span class="sd">    itex: Specifies if itex-specific syntax is used, including emitting ``$$ $$``.</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*mu)**Rational(7,2), mode=&#39;equation&#39;, itex=True))</span>
<span class="sd">    $$8 \sqrt{2} \mu^{\frac{7}{2}}$$</span>

<span class="sd">    fold_frac_powers: Emit &quot;^{p/q}&quot; instead of &quot;^{\frac{p}{q}}&quot; for fractional</span>
<span class="sd">    powers.</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**Rational(7,2), fold_frac_powers=True))</span>
<span class="sd">    8 \sqrt{2} \tau^{7/2}</span>

<span class="sd">    fold_func_brackets: Fold function brackets where applicable.</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**sin(Rational(7,2))))</span>
<span class="sd">    \left(2 \tau\right)^{\sin{\left (\frac{7}{2} \right )}}</span>
<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**sin(Rational(7,2)), fold_func_brackets = True))</span>
<span class="sd">    \left(2 \tau\right)^{\sin {\frac{7}{2}}}</span>

<span class="sd">    fold_short_frac: Emit &quot;p / q&quot; instead of &quot;\frac{p}{q}&quot; when the</span>
<span class="sd">    denominator is simple enough (at most two terms and no powers).</span>
<span class="sd">    The default value is `True` for inline mode, False otherwise.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(3*x**2/y))</span>
<span class="sd">    \frac{3 x^{2}}{y}</span>
<span class="sd">    &gt;&gt;&gt; print(latex(3*x**2/y, fold_short_frac=True))</span>
<span class="sd">    3 x^{2} / y</span>

<span class="sd">    long_frac_ratio: The allowed ratio of the width of the numerator to the</span>
<span class="sd">    width of the denominator before we start breaking off long fractions.</span>
<span class="sd">    The default value is 2.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(Integral(r, r)/2/pi, long_frac_ratio=2))</span>
<span class="sd">    \frac{\int r\, dr}{2 \pi}</span>
<span class="sd">    &gt;&gt;&gt; print(latex(Integral(r, r)/2/pi, long_frac_ratio=0))</span>
<span class="sd">    \frac{1}{2 \pi} \int r\, dr</span>

<span class="sd">    mul_symbol: The symbol to use for multiplication. Can be one of None,</span>
<span class="sd">    &quot;ldot&quot;, &quot;dot&quot;, or &quot;times&quot;.</span>

<span class="sd">    &gt;&gt;&gt; print(latex((2*tau)**sin(Rational(7,2)), mul_symbol=&quot;times&quot;))</span>
<span class="sd">    \left(2 \times \tau\right)^{\sin{\left (\frac{7}{2} \right )}}</span>

<span class="sd">    inv_trig_style: How inverse trig functions should be displayed. Can be one</span>
<span class="sd">    of &quot;abbreviated&quot;, &quot;full&quot;, or &quot;power&quot;. Defaults to &quot;abbreviated&quot;.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(asin(Rational(7,2))))</span>
<span class="sd">    \operatorname{asin}{\left (\frac{7}{2} \right )}</span>
<span class="sd">    &gt;&gt;&gt; print(latex(asin(Rational(7,2)), inv_trig_style=&quot;full&quot;))</span>
<span class="sd">    \arcsin{\left (\frac{7}{2} \right )}</span>
<span class="sd">    &gt;&gt;&gt; print(latex(asin(Rational(7,2)), inv_trig_style=&quot;power&quot;))</span>
<span class="sd">    \sin^{-1}{\left (\frac{7}{2} \right )}</span>

<span class="sd">    mat_str: Which matrix environment string to emit. &quot;smallmatrix&quot;, &quot;matrix&quot;,</span>
<span class="sd">    &quot;array&quot;, etc. Defaults to &quot;smallmatrix&quot; for inline mode, &quot;matrix&quot; for</span>
<span class="sd">    matrices of no more than 10 columns, and &quot;array&quot; otherwise.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(Matrix(2, 1, [x, y])))</span>
<span class="sd">    \left[\begin{matrix}x\\y\end{matrix}\right]</span>

<span class="sd">    &gt;&gt;&gt; print(latex(Matrix(2, 1, [x, y]), mat_str = &quot;array&quot;))</span>
<span class="sd">    \left[\begin{array}{c}x\\y\end{array}\right]</span>

<span class="sd">    mat_delim: The delimiter to wrap around matrices. Can be one of &quot;[&quot;, &quot;(&quot;,</span>
<span class="sd">    or the empty string. Defaults to &quot;[&quot;.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(Matrix(2, 1, [x, y]), mat_delim=&quot;(&quot;))</span>
<span class="sd">    \left(\begin{matrix}x\\y\end{matrix}\right)</span>

<span class="sd">    symbol_names: Dictionary of symbols and the custom strings they should be</span>
<span class="sd">    emitted as.</span>

<span class="sd">    &gt;&gt;&gt; print(latex(x**2, symbol_names={x:&#39;x_i&#39;}))</span>
<span class="sd">    x_i^{2}</span>

<span class="sd">    Besides all Basic based expressions, you can recursively</span>
<span class="sd">    convert Python containers (lists, tuples and dicts) and</span>
<span class="sd">    also SymPy matrices:</span>

<span class="sd">    &gt;&gt;&gt; print(latex([2/x, y], mode=&#39;inline&#39;))</span>
<span class="sd">    $\begin{bmatrix}2 / x, &amp; y\end{bmatrix}$</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">LatexPrinter</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span><span class="o">.</span><span class="n">doprint</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="print_latex"><a class="viewcode-back" href="../../../modules/printing.html#sympy.printing.latex.print_latex">[docs]</a><span class="k">def</span> <span class="nf">print_latex</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prints LaTeX representation of the given expression.&quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">SymPy 0.7.3 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../sympy.html" >sympy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013 SymPy Development Team.
      Last updated on Aug 04, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>